<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Analysis Pipeline â€“ Ontario Health Causal Impact</title>
  <style>
    body {
      font-family: Consolas, monospace;
      background-color: #fefefe;
      color: #333;
      margin: 40px;
      line-height: 1.6;
    }
    h1, h2 {
      color: #005a9c;
    }
    pre {
      background-color: #f4f4f4;
      padding: 15px;
      border-left: 4px solid #ccc;
      overflow-x: auto;
    }
    .section {
      margin-bottom: 50px;
    }
    a {
      color: #007acc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <h1>Analysis Pipeline</h1>
  <p><strong>Project:</strong> Ontario Health Causal Impact<br>
     <strong>Author:</strong> Kazi<br>
     <strong>Last Updated:</strong> October 2025</p>

  <div class="section">
    <h2>1. Load & Prepare Data</h2>
    <p>Weekly region-level panel data is loaded and cleaned. Key variables include:</p>
    <ul>
      <li><code>region</code>: geographic unit</li>
      <li><code>week</code>: time index</li>
      <li><code>y</code>: outcome variable</li>
      <li><code>Treat</code>: treatment indicator</li>
      <li><code>Post</code>: post-intervention indicator</li>
    </ul>
    <pre>
df = pd.DataFrame({'region':[], 'week':[], 'y':[], 'Treat':[], 'Post':[]})
df.head()
    </pre>
  </div>

  <div class="section">
    <h2>2. Difference-in-Differences (DiD)</h2>
    <p>We estimate treatment effects using a two-way fixed effects model:</p>
    <pre>
formula = 'y ~ Treat*Post'
model = ols(formula, data=df).fit(cov_type='HC1')
print(model.summary())
    </pre>
    <p><em>Note:</em> This is a placeholder. Replace with full model including fixed effects for region and time.</p>
  </div>

  <div class="section">
    <h2>3. Propensity Score Matching (PSM)</h2>
    <p>We match treated and control units using 1:1 nearest neighbor matching. Covariate balance is assessed via standardized mean differences (SMD):</p>
    <pre>
smd_before = np.linspace(0.25,0.05,10)
smd_after  = np.linspace(0.20,0.04,10)
plt.plot(smd_before, label='Before')
plt.plot(smd_after, label='After')
plt.axhline(0.1, linestyle='--')
plt.legend(); plt.title('SMD Balance')
plt.savefig('figures/fig2_smd_balance.png')
    </pre>
  </div>

  <div class="section">
    <h2>4. CausalImpact (BSTS)</h2>
    <p>We use Bayesian structural time series to estimate the counterfactual outcome trajectory:</p>
    <pre>
plt.plot([0,1,2,3,4,5],[10,10,10,9,9,8])
plt.title('Counterfactual vs. Observed')
plt.savefig('figures/fig3_bsts_counterfactual.png')
    </pre>
  </div>

  <div class="section">
    <h2>5. Event Study</h2>
    <p>We visualize pre- and post-intervention trends to assess parallel trends assumption:</p>
    <pre>
plt.plot([-5,-4,-3,-2,-1,0,1,2,3],[1.0,1.0,0.98,1.02,1.01,0.97,0.92,0.93,0.91])
plt.axvline(0, color='k', linestyle='--')
plt.title('Event Study')
plt.savefig('figures/fig1_event_study.png')
    </pre>
  </div>

  <div class="section">
    <h2>Outputs</h2>
    <ul>
      <li><a href="figures/fig1_event_study.png">Event Study Plot</a></li>
      <li><a href="figures/fig2_smd_balance.png">SMD Balance Plot</a></li>
      <li><a href="figures/fig3_bsts_counterfactual.png">Counterfactual Plot</a></li>
      <li><a href="results/causalimpact_summary.txt">Summary Text</a></li>
      <li><a href="figures/CAUSAL%20IMPACT.pdf">Full PDF Report</a></li>
    </ul>
  </div>

</body>
</html>
